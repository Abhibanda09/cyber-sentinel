import Phaser from 'phaser';
import { dataEmitter } from '../services/DataEmitter';

export class Malware extends Phaser.Physics.Arcade.Sprite {
    constructor(scene, x, y, type = 'standard') {
        super(scene, x, y, ''); // We'll use a shape since we have no assets yet
        
        scene.add.existing(this);
        scene.physics.add.existing(this);

        this.hp = type === 'boss' ? 5 : 1;
        this.enemyType = type;
        this.speed = type === 'fast' ? 150 : 80;

        // Visual placeholder
        const color = type === 'fast' ? 0xff0000 : 0x00ffff;
        scene.add.rectangle(x, y, 30, 30, color).setOrigin(0.5).setParent(this);
    }

    update(player) {
        // Move towards the player (the Firewall Node)
        this.scene.physics.moveToObject(this, player, this.speed);
    }

    takeDamage() {
        this.hp--;
        if (this.hp <= 0) {
            this.destroyEnemy();
        }
    }

    destroyEnemy() {
        // WINNING MOVE: Send data when enemy dies
        dataEmitter.emit('enemy_destroyed', {
            type: this.enemyType,
            x: Math.floor(this.x),
            y: Math.floor(this.y),
            lifespan: this.scene.time.now - this.spawnTime
        });
        
        this.destroy();
    }
}